<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="apple-itunes-app" content="app-id=593777236" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>git 切换分支的时候 是否需要提交当前已经修改的 - SegmentFault</title>
<meta name="description" content="专业面向开发者的中文技术问答社区" /> 
<meta name="keywords" content="SegmentFault SF 开发者 程序员 中文 问答 社区" />

<link rel="stylesheet" href="http://s.segmentfault.com/css/normalize.css?13.8.23.3" />
<link rel="stylesheet" href="http://s.segmentfault.com/css/style.css?13.8.23.3" />
<link rel="stylesheet" href="http://s.segmentfault.com/css/responsive.css?13.8.23.3" />

<script src="http://s.segmentfault.com/js/jquery.js?13.8.23.3"></script>
<script src="http://s.segmentfault.com/js/lib.js?13.8.23.3"></script>
<script src="http://s.segmentfault.com/js/highlight.js?13.8.23.3"></script>

<!--[if gt IE 8]>
    <link rel="stylesheet" href="http://s.segmentfault.com/css/ie.css?13.8.23.3" />
<![endif]-->
<!--[if lte IE 8]>
    <script src="http://s.segmentfault.com/js/html5.js?13.8.23.3"></script>
    <link rel="stylesheet" href="http://s.segmentfault.com/css/old-ie.css?13.8.23.3" />
<![endif]-->

<link href="http://s.segmentfault.com/img/icon/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="SegmentFault" />

<link rel="apple-touch-icon-precomposed" href="http://s.segmentfault.com/img/icon/sf-57.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://s.segmentfault.com/img/icon/sf-72.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://s.segmentfault.com/img/icon/sf-114.png" />

<link rel="alternate" type="application/atom+xml" title="订阅 git 切换分支的时候 是否需要提交当前已经修改的 - SegmentFault" href="http://segmentfault.com/feeds/q/1010000000156026">


</head>
<body id="body">
<!--[if lte IE 8]>
    <div class="error chromeframe">您的浏览器版本<strong>很旧很旧</strong>，为了正常地访问网站，请升级您的浏览器 <a target="_blank" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->


<nav class="global-nav clearfix"></nav>
<!-- end .site-header -->
<div class="wrap">

<div class="inner edge">
    <h1 class="top-title" data-id="1010000000156026">git 切换分支的时候 是否需要提交当前已经修改的</h1>
    <div id="main">
        <div id="question">
            <article class="q-post" id="q-1010000000156026" data-id="1010000000156026">
              <div class="fmt post-content">
                <p>官方文档有句话“切换分支的时候最好保持一个清洁的工作区域。”，不知道我的理解是不是正确的。如果你当前分支有修改，但是还没有commit，如果你要切换分支的话，最好就是把内容都commit了？还是只用add到暂存区，下次回来可以继续。</p>                </div><!-- end .post-content -->
                <!-- end .post-foot -->
</article>
        </div><!-- end #question -->
                <div id="answer">
                  <h2 class="a-title">&nbsp;</h2>
            
            <!-- 
            <div class="iamgg-main rounded-2">
                <small><a href="http://segmentfault.com/advertise">赞助商广告</a></small>
            </div>
            -->
            
                                                            <article class="a-post available" id="a-1020000000156080" data-id="1020000000156080" data-created="1356500687" data-votes="2">
                                                              <div class="fmt post-content">
                    <p>我推荐你用git stash 暂存起来，切换回来的时候用git stash apply重新获取刚才的变更。切换的时候给你一个干净的工作目录:)</p>                </div><!-- end .post-content -->
                  </article>
                        <article class="a-post available" id="a-1020000000166448" data-id="1020000000166448" data-created="1359363816" data-votes="1">
                          <div class="fmt post-content">
                    <blockquote>如果你当前分支有修改，但是还没有commit，如果你要切换分支的话，最好就是把内容都commit了？</blockquote><p>不是，因为你的change还不一定ready for commit，根据你的实际情况，你可以git stash暂存，你可以commit生成一个新的提交，你也可以git checkout -f强制切换分支</p>                </div><!-- end .post-content -->
                  </article>
                        <article class="a-post available" id="a-1020000000156074" data-id="1020000000156074" data-created="1356500570" data-votes="0">
                          <div class="fmt post-content">
                    <p>没有进行commit并切换分支，当前文件还在缓冲区。<br />
不是对当前Git版本，进行提交。<br />
在任意分支下还可reset修改或commit.</p><p>测试</p><pre>git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.st status

git br a
git br 
git br b

git co a
touch a.py
git add .

git co b
git st
git add .
git commit -m 'add a.py file'
git st

当前文件就回出现b分支下
如果这样，退回上次commit
git reset --hard</pre>                </div><!-- end .post-content -->
                  </article>
                                                            
      </div><!-- end #answer -->
      <!-- end #write-answer -->
    </div>
    <!-- end #main -->
    <!-- end #secondary -->
</div>
</div><!-- end .wrap -->

<footer id="footer">
  <div class="inner"></div>
</footer>

<div class="login-notify hidden">
    <a href="#" class="right i-cancel">关闭</a>
    <span>欢迎来到最专业的中文开发者社区：</span>
    <a class="auth-small" href="http://segmentfault.com/user/login"><img src="http://s.segmentfault.com/img/icon/auth-sf.png" alt="SegmentFault"/>立即登录</a>
                <a class="auth-small" href="https://segmentfault.com/user/oauth/google"><img src="http://s.segmentfault.com/img/icon/auth-google-big.png" alt="Google" />Google</a>
            <a class="auth-small" href="https://segmentfault.com/user/oauth/github"><img src="http://s.segmentfault.com/img/icon/auth-github-big.png" alt="GitHub" />GitHub</a>
            <a class="auth-small" href="https://segmentfault.com/user/oauth/weibo"><img src="http://s.segmentfault.com/img/icon/auth-weibo-big.png" alt="新浪微博" />新浪微博</a>
            <a class="auth-small" href="https://segmentfault.com/user/oauth/qq"><img src="http://s.segmentfault.com/img/icon/auth-qq-big.png" alt="腾讯微博" />腾讯微博</a>
</div>
<script>$(document).ready(function(){$('#session').login();$('input[holder],textarea[holder]').placeholder();$('input.input-error,textarea.input-error').keyup(function(){$('.text-error',$(this).removeClass('input-error').parent()).remove();});$('.has-dropdown').hover(function(){var $item=$('.dropdown-item',this);$item.toggleClass('hid');});$('#site-nav-btn').click(function(){$('.site-nav').toggleClass('mobi-hide');return false;});$('html').click(function(){$('.site-nav').addClass('mobi-hide');});$('#msg-link').eventPopup({url:'http://x.segmentfault.com/event'});$('.meta-tags a, .tag').tagPopup('http://segmentfault.com/api/tag','#main');$('#search .input-search').searchAutoComplete({url:'http://x.segmentfault.com/autocomplete',insertAfter:'#search',searchUrl:'http://segmentfault.com/search',askUrl:'http://segmentfault.com/ask',ask:'#top-nav a.btn-m'});$('a.msg-close',$('#msg-bar').fadeIn().sticky()).click(function(){$(this).parent().fadeOut(function(){$(this).parent().remove();});return false;});var topNav=$('.head-nav'),search=$('#search .input-search').css({'position':'relavtive','z-index':10}),searchWidth=search.outerWidth();search.focus(function(){search.animate({width:searchWidth*1.5},'fast');topNav.hide();}).blur(function(){if(0==search.val().length){search.animate({width:searchWidth},'fast',function(){topNav.show();});}});$('.tip-pop').each(function(){var t=$(this),str=t.data('tip');if(!!!str){return;}
t.removeAttr('title');var parts=str.split(':');$(this).tipsy({'html':true,'gravity':parts.shift(),'fallback':parts.join(':')});});if($('#profile-tab,.greeting').length>0){$.get('http://x.segmentfault.com/news',function(o){if(!o.status&&o.data){var cv=$.cookie('sfns_viewed'),viewed=(!!cv?cv+',':'');if(viewed.indexOf(o.data[0])<0){var a=$('<a href="'+o.data[1]+'" target="_blank" class="update-log rounded-2">'
+'<strong>'+o.data[3]+'更新</strong> '+o.data[2]+'</a>').prependTo('#secondary').animate({backgroundColor:'#ffebb7'},'slow',function(){$(this).animate({backgroundColor:'#FFF7E2'},'slow');}).click(function(){$.cookie('sfns_viewed',viewed+o.data[0],{path:'/',expires:30});$(this).remove();});}}},'jsonp');}
if(login){$('#main, .layout-main').highlightTag({url:'http://x.segmentfault.com/tag/following',selector:'#content article .meta-tags li a, #user-question article .meta-tags li a,'
+' .article-item .tags li a',className:'q-highlight'});}else if(0==$('.auth-login,.session-form,.session-finished').length){if(1!=$.cookie('sfln_viewed')){$.cookie('sfln_viewed',1,{path:'/'});$.cookie('sfln_available',1,{path:'/'});}else if(1==$.cookie('sfln_available')){$('.i-cancel',$('.login-notify').css('bottom',-60).removeClass('hidden').animate({'bottom':0})).click(function(){$.cookie('sfln_available',0,{path:'/'});$(this).parents('.login-notify').animate({'bottom':-60},function(){$(this).remove();});return false;});}}
var tagInterestShow=false;$('.tag-interest-click').click(function(){if(!tagInterestShow){$('.tag-interest-list').fadeIn();tagInterestShow=true;}else{$('.tag-interest-list').fadeOut();tagInterestShow=false;}
return false;});});(function(){var hm=document.createElement('script');hm.type='text/javascript';hm.async=true;hm.src='//hm.baidu.com/hm.js?e23800c454aa573c0ccb16b52665ac26';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(hm,s);})();var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-918487-8']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script>
<script>(function(){if('undefined'==typeof(hljs)){return;}
hlNames={actionscript:/^as[1-3]$/i,cmake:/^(make|makefile)$/i,cs:/^csharp$/i,css:/^css[1-3]$/i,delphi:/^pascal$/i,javascript:/^js$/i,markdown:/^md$/i,objectivec:/^objective\-c$/i,php:/^php[1-6]$/i,sql:/^mysql$/i,xml:/^(html|html5|xhtml)$/i},hlLangs=hljs.LANGUAGES;SF.highlight=function(sel){var el=$(sel);$('pre',el).each(function(){if(!this.parentNode){return;}
var t=$(this),children=t.children(),highlighted=false;if(children.length>0&&'code'==children.get(0).nodeName.toLowerCase()){var className=children.attr('class');if(!!className){var classes=className.split(/\s+/);for(var i=0;i<classes.length;i++){if(0===classes[i].indexOf('lang-')){var lang=classes[i].substring(5).toLowerCase(),finalLang;if(hlLangs[lang]){finalLang=lang;}else{for(var l in hlNames){if(lang.match(hlNames[l])){finalLang=l;}}}
if(!!finalLang){var result=hljs.highlight(finalLang,children.text(),true);children.html(result.value);highlighted=true;break;}}}}}
if(!highlighted){var html=t.html();t.html(html.replace(/<\/?[a-z]+[^>]*>/ig,''));hljs.highlightBlock(this,'',false);}});};})();</script><script>$(document).ready(function(){var title=$('.top-title');SF.highlight('article .post-content');$('article .post-content a').attr('target','_blank');$('article .post-content').specialUrl();$('article .post-content img').each(function(){var t=$(this),url=t.attr('src');t.wrap('<a target="_blank" title="点击查看原图" href="'+url+'/view"></a>');});function applyCommentEvent(li){$('.comment-vote',li).click(function(){var t=$(this),comment=t.parents('li.comment').data('comment');$.post('http://segmentfault.com/api/comment',{'do':'like','id':comment.id,'cancel':t.hasClass('c-voted')?1:0},function(o){if(!o.status){t.toggleClass('c-voted').text(o.data);if(o.data==0){t.addClass('no-vote');}else{t.removeClass('no-vote');}}},'json');return false;});$('.reply',li).click(function(){var comment=$(this).parents('li.comment').data('comment'),p=$(this).parents('ul.comment-list'),formAction=$('.add-comment form .form-action',p);$('li:last',p).removeClass('hidden');$('.reply-to',formAction).remove();var reply=$('<span class="reply-to left"><a href="#" class="i-cancel">&#10006;</a>回复 <a target="_blank" href="'
+comment.user.url+'">'+comment.user.name+'</a><input type="hidden" name="reply" value="'+comment.user.id+'" /></span>').prependTo(formAction);$('a.i-cancel',reply).click(function(){$(this).parent().remove();return false;});$('.add-comment form textarea',p).focus();return false;});$('.edit',li).click(function(){var t=$(this).parents('li.comment'),comment=t.data('comment'),p=$('.comment-content p',t).hide(),formP=$('<div class="add-comment"></div>').insertAfter(p),contentP=$('<div class="form-content"></div>').appendTo(formP),textarea=$('<textarea name="text" class="textarea-13" holder="输入您要修改的文字" rows="1"></textarea>').appendTo(contentP).autoResize().val(comment.originalText).placeholder();var actionP=$('<div class="form-action"></div>').appendTo(formP),submitBtn=$('<button class="btn btn-l action">修改评论</button>').appendTo(actionP),cancelBtn=$('<button class="btn btn-l">取消</button>').appendTo(actionP);submitBtn.click(function(){var btn=$(this);btn.attr('disabled','disabled').addClass('btn-disabled');$.post('http://segmentfault.com/api/comment',{'do':'edit','id':comment.id,'text':textarea.val()},function(o){if(!o.status){appendComment.call(p,o.data,t);t.remove();}else if(5==o.status){textarea.error('字数太短, 至少要包括6个字符');btn.removeAttr('disabled').removeClass('btn-disabled');}},'json');});cancelBtn.click(function(){p.show();$('.comment-action',t).removeClass('hidden');formP.remove();});$('.comment-action',t).addClass('hidden');return false;});$('.delete',li).click(function(){var t=$(this).parents('li.comment'),comment=t.data('comment');$('<p>您确认删除来自「'+comment.user.name+'」的评论吗?</p>').modal({'title':'删除确认','action':'删除','onAction':function(c){$.post('http://segmentfault.com/api/comment',{'do':'delete','id':comment.id},function(o){if(!o.status){t.fadeOut();}
c.trigger('close');},'json');}});return false;});}
function appendComment(c,after){var html='<li class="comment" id="c-'+c.objectId+'-'+c.id+'">';html+='<div class="left comment-vote'+(c.votes>0?'':' no-vote')
+(c.isLiked?' c-voted':'')+'">'+c.votesWord+'</div>',p=$(this),f=$('li:last',p);if(login){html+='<div class="right comment-action">'
+(c.canEdit?'<a class="i-edit edit" href="#">修改</a> ':'')
+(c.canDelete?'<a class="i-trash delete" href="#">删除</a> ':'')
+(login.id!=c.user.id?'<a class="i-reply reply" href="#">回复</a> ':'')
+'</div>';}
html+='<div class="fmt comment-content">'
+'<cite><a href="'+c.user.url+'">'+c.user.name+'</a> &middot; '+c.createdDate+'</cite>'
+(c.replyUser?'回复<a target="_blank" href="'+c.replyUser.url+'">'
+c.replyUser.name+'</a>:<br />':'')+c.parsedText
+'</div></li>';var li=$(html).data('comment',c);if(after){li.insertAfter(after);}else{if(f){li.insertBefore(f);}else{li.appendTo(p);}}
applyCommentEvent(li);}
$('ul.comment-list').each(function(){var p=$(this),closed=$('#question article').hasClass('closed'),deleted=$('#question article').hasClass('deleted'),f;$('li.comment',this).each(function(){applyCommentEvent(this);});if(login&&!closed&&!deleted){f=$('<li class="add-comment hidden"><form action="http://segmentfault.com/api/comment?do=post">'
+'<input type="hidden" value="'+p.parents('article').data('id')+'" name="id" />'
+'<div class="form-content"><textarea name="text" class="textarea-13" holder="写下您的评论"></textarea></div>'
+'<div class="form-action"><input type="submit" class="btn btn-l" value="提交评论" /></div></form></li>');$('textarea',f.appendTo(p)).placeholder().autoResize();$('form',f).submit(function(){var t=$(this),url=t.attr('action');$('.btn',this).attr('disabled','disabled');$.post(url,t.serialize(),function(o){var ta=$('textarea',t);$('.btn',t).removeAttr('disabled');if(!o.status){appendComment.call(p,o.data);$('.reply-to',t).remove();ta.val('').focus();}else if(5==o.status){ta.error('字数太短, 至少要包括6个字符');}},'json');return false;});}else if(!login){f=$('<li class="hidden"><cite>您还没有登录, 请<a href="http://segmentfault.com/user/login">登录</a>后添加评论</cite></li>').appendTo(p);}else if(closed){f=$('<li class="hidden"><cite>此问题已关闭, 无法添加评论</cite></li>').appendTo(p);}else if(deleted){f=$('<li class="hidden"><cite>此问题已删除, 无法添加评论</cite></li>').appendTo(p);}});$('a.more-comments').click(function(){if(this.clicked){return false;}
this.clicked=true;var t=$(this),p=t.parents('ul.comment-list'),f=$('li:last',p).removeClass('hidden');t.addClass('loading');$('textarea',f.removeClass('hidden'));$.getJSON(t.data('url'),function(o){t.parent().remove();if(!o.status){var lastUid,lastName,submit=$('input[type=submit]',f);$('li.comment',p).remove();for(var i=0;i<o.data.length;i++){appendComment.call(p,o.data[i]);if(login&&login.id!=o.data[i].user.id){lastUid=o.data[i].user.id;lastName=o.data[i].user.name;}}}});return false;});$('#answer .hor-tabs .by-votes').click(function(){$('.current',$(this).parent()).removeClass('current');$(this).addClass('current');function sortByVotes(a,b){var a=$(a),b=$(b),votesA=a.data('votes'),votesB=b.data('votes'),idA=a.data('id'),idB=b.data('id');if(votesA>votesB){return-1;}else if(votesA<votesB){return 1;}else{return idA>idB?1:-1;}}
$('#answer article.available').sortElements(sortByVotes);$('#answer article.ignored').sortElements(sortByVotes);return false;});$('#answer .hor-tabs .by-created').click(function(){$('.current',$(this).parent()).removeClass('current');$(this).addClass('current');function sortByCreated(a,b){var a=$(a),b=$(b),createdA=a.data('created'),createdB=b.data('created'),idA=a.data('id'),idB=b.data('id');if(createdA>createdB){return 1;}else if(createdA<createdB){return-1;}else{return idA>idB?1:-1;}}
$('#answer article.available').sortElements(sortByCreated);$('#answer article.ignored').sortElements(sortByCreated);return false;});$('.input-share input.text-27').click(function(){$(this).select();return false;});$('article.a-ignore a').click(function(){$(this).parent().remove();$('#answer article.ignored').show();return false;});$('#question .post-fav').click(function(){var t=$(this),id=t.parents('article').data('id');$.post('http://segmentfault.com/api/question',{'do':'bookmark','id':id,'cancel':t.hasClass('faved')?1:0},function(o){if(!o.status){t.toggleClass('faved').html(t.hasClass('faved')?'已收藏':'收藏');}},'json');return false;});$('#question article .post-big-vote').click(function(e){var t=$(this),p=t.parents('article'),id=p.data('id');$.post('http://segmentfault.com/api/question',{'do':'like','id':id,'cancel':t.hasClass('voted')?1:0},function(o){if(!o.status){$('span',t.toggleClass('voted')).html(o.data);if(t.hasClass('voted')){$('.post-big-hate',p).removeClass('hated');}}},'json');return false;});$('#question article .post-big-hate').click(function(e){var t=$(this),p=t.parents('article'),id=p.data('id');$.post('http://segmentfault.com/api/question',{'do':'hate','id':id,'cancel':t.hasClass('hated')?1:0},function(o){if(!o.status){t.toggleClass('hated');$('.post-big-vote span',p).html(o.data);if(t.hasClass('hated')){$('.post-big-vote',p).removeClass('voted');}}},'json');return false;});$('#answer article .post-big-vote').click(function(){var t=$(this),p=t.parents('article'),id=p.data('id');$.post('http://segmentfault.com/api/answer',{'do':'like','id':id,'cancel':t.hasClass('voted')?1:0},function(o){if(!o.status){$('span',t.toggleClass('voted')).html(o.data);if(t.hasClass('voted')){$('.post-big-hate',p).removeClass('hated');}}},'json');return false;});$('#answer article .post-big-hate').click(function(){var t=$(this),p=t.parents('article'),id=p.data('id');$.post('http://segmentfault.com/api/answer',{'do':'hate','id':id,'cancel':t.hasClass('hated')?1:0},function(o){if(!o.status){t.toggleClass('hated');$('.post-big-vote span',p).html(o.data);if(t.hasClass('hated')){$('.post-big-vote',p).removeClass('voted');}}},'json');return false;});$('#question .post-action .close').click(function(){var p=$(this).parents('article.q-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要'+(cancel?'重新打开':'关闭')
+'问题「<strong></strong>」吗?</p>');$('strong',word).text(title.text());word.modal({'title':cancel?'重新打开确认':'关闭确认','action':cancel?'重新打开':'关闭','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'close','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#question .post-action .delete').click(function(){var p=$(this).parents('article.q-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要'+(cancel?'恢复':'删除')
+'问题「<strong></strong>」吗?</p>');$('strong',word).text(title.text());word.modal({'title':cancel?'恢复确认':'删除确认','action':cancel?'恢复':'删除','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'delete','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#question .post-action .hide').click(function(){var p=$(this).parents('article.q-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要'+(cancel?'显示':'隐藏')
+'问题「<strong></strong>」吗?</p>');$('strong',word).text(title.text());word.modal({'title':cancel?'显示确认':'隐藏确认','action':cancel?'显示':'隐藏','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'hide','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#question .post-action .push').click(function(){var p=$(this).parents('article.q-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要问题「<strong></strong>」'+(cancel?'在主站隐藏':'在主站显示')
+'吗?</p>');$('strong',word).text(title.text());word.modal({'title':cancel?'主站隐藏确认':'主站显示确认','action':cancel?'主站隐藏':'主站显示','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'push','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#question .post-action .site').click(function(){var p=$(this).parents('article.q-post');$.get('http://segmentfault.com/api/site?do=list',function(o){if(!o.status&&!!o.data&&o.data.length>0){var select='<select id="site-select"><option value="0">主站</option>';for(var i=0;i<o.data.length;i++){var s=o.data[i];select+='<option value="'+s.id+'">'+s.name+'</option>';}
select+='</select>';$('<p><label for="site-select">请选择站点</label> '+select+'</p>').modal({'title':'站点推送','action':'推送','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'site','id':data,'site':$('select',c).val()},function(o){if(!o.status){window.location.reload();}},'json');}});}},'json');return false;});$('#question .post-action .publish').click(function(){var p=$(this).parents('article.q-post'),word=$('<p>您确认要发布问题「<strong></strong>」吗?</p>');$('strong',word).text(title.text());word.modal({'title':'发布确认','action':'发布','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/question',{'do':'publish','id':data},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#answer .a-post .post-action .delete').click(function(){var p=$(this).parents('article.a-post'),word=$('<p>您确认要删除「<strong></strong>」的答案吗?</p>');$('strong',word).text($('.post-author h4 a',p).text());word.modal({'title':'删除确认','action':'删除','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/answer',{'do':'delete','id':data},function(o){if(!o.status){p.fadeOut();c.trigger('close');}},'json');}});return false;});$('#answer .a-post .post-action .ignore').click(function(){var p=$(this).parents('article.a-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要'+(cancel?'取消忽略':'忽略')
+'「<strong></strong>」的答案吗?</p>');$('strong',word).text($('.post-author h4 a',p).text());word.modal({'title':cancel?'取消忽略确认':'忽略确认','action':cancel?'取消忽略':'忽略','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/answer',{'do':'ignore','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});$('#answer .a-post .post-action .btn-accept').click(function(){var p=$(this).parents('article.a-post'),cancel=$(this).data('cancel'),word=$('<p>您确认要'+(cancel?'取消采纳':'采纳')
+'「<strong></strong>」的答案吗?</p>');$('strong',word).text($('.post-author h4 a',p).text());word.modal({'title':cancel?'取消采纳确认':'采纳确认','action':cancel?'取消采纳':'采纳','data':p.data('id'),'onAction':function(c,data){$.post('http://segmentfault.com/api/answer',{'do':'accept','id':data,'cancel':cancel},function(o){if(!o.status){window.location.reload();}},'json');}});return false;});var mdLoaded=false;$('#wmd-input').focus(function(){if(!mdLoaded){$.getScript('http://s.segmentfault.com/js/markdown.js?13.8.23.3',function(){SF.editor('http://segmentfault.com/img/','http://segmentfault.com/api/upload/img','http://segmentfault.com/api/upload/fetch');});$('#write-answer .preview, #write-answer .form-action').removeClass('hidden');$(this).removeClass('fold');}
mdLoaded=true;});$('#confirm-answer').click(function(){$(this).parent().remove();$('#wmd-input').focus();return false;});var inviteHtml=$('#invite-popup').html(),inviteTab;$('.invite-to-answer a.btn-m').click(function(){var showed={username:true,email:false,weibo:false},id=$('#question article.q-post').data('id');$(inviteHtml).modal({title:'邀请回答',action:'邀请',onShow:function(c){$('#by-weibo textarea',c).val('我在 @SegmentFault 上遇到了问题「'
+title.text()+'」, 希望您能帮我解答 '+$('.input-share input.text-27').val());$('#by-email textarea',c).val('我在 SegmentFault.com 上遇到了问题「'
+title.text()+'」, 希望您能帮我解答 '+$('.input-share input.text-27').val());inviteTab='username';$('#by-username input.text-28',c).placeholder('holder').commonAutoComplete({'url':'http://x.segmentfault.com/autocomplete/user','resultsFormatter':function(item){return'<li>'+(item.avatarUrl?'<img class="avatar-24" src="'+item.avatarUrl+'" />':'')+item.name+'</li>';},'onEmpty':'<li>没有找到用户</li>','onEnter':function(user){$('.i-cancel',$('<li><a target="_blank" href="'+user.url+'"><img class="avatar-24" src="'+user.avatarUrl
+'" alt="'+user.name+'">'+user.name
+'</a> <a href="#" class="i-cancel">&#10006;</a></li>').appendTo($('.invited-list',c)).data('uid',user.id)).click(function(){$('#by-username .search-user',c).show();$('#by-username .invited-list',c).html('');return false;});$(this).val('');$('#by-username .search-user').hide();}});$('.hor-tabs a',c).click(function(){var current=$('a.current',$(this).parent()),currentBy=current.data('by'),nowBy=$(this).data('by');$('#by-'+currentBy,c).hide();$('#by-'+nowBy,c).show();current.removeClass('current');$(this).addClass('current');inviteTab=nowBy;if(!showed[nowBy]){$('#by-'+nowBy+' input.text-28').placeholder('holder');if('weibo'==nowBy){$('#by-weibo input.text-28',c).commonAutoComplete({'url':'http://x.segmentfault.com/autocomplete/weibo','resultsFormatter':function(item){return'<li>'+item.name+'</li>';},'onTip':'<li>输入关键字搜索微博用户</li>','onEmpty':'<li>没有找到微博用户</li>','onEnter':function(user){var text=$('#by-weibo textarea.textarea-13',c).val();$(this).val('');$('#by-weibo textarea.textarea-13',c).val('@'+user.name+' '+text);}});}
showed[nowBy]=true;}
return false;});},onAction:function(c){switch(inviteTab){case'username':var userId=$('.invited-list li',c).data('uid');$.post('http://segmentfault.com/api/question',{'do':'invite','id':id,'uid':userId,'type':'user'},function(o){if(!o.status){c.trigger('close');window.location.reload();}else{$('#by-username .search-user',c).show();$('#by-username .invited-list',c).html('');if(4==o.status){$('#by-username input.text-28',c).error('请选择一个用户邀请');}else if(5==o.status){$('#by-username input.text-28',c).error('此用户已经被邀请过');}else if(6==o.status){$('#by-username input.text-28',c).error('此用户已经回答过该问题');}else if(7==o.status){$('#by-username input.text-28',c).error('邀请次数超过每天的最大限制');}}});break;case'email':var mail=$('#by-email input.text-28',c).val(),text=$('#by-email textarea.textarea-13',c).val();$.post('http://segmentfault.com/api/question',{'do':'invite','id':id,'mail':mail,'text':text,'type':'mail'},function(o){if(!o.status){c.trigger('close');window.location.reload();}else if(4==o.status){$('#by-email input.text-28',c).error('请准确输入发送邮箱');}else if(5==o.status){$('#by-email textarea.textarea-13',c).error('请至少输入10字以上的邀请文字');}else if(6==o.status){$('#by-email textarea.textarea-13',c).error('邀请文字中必须包含问题链接');}else if(7==o.status){$('#by-email textarea.textarea-13',c).error('邀请次数超过每天的最大限制');}});break;case'weibo':var text=$('#by-weibo textarea.textarea-13',c).val();$.post('http://segmentfault.com/api/question',{'do':'invite','id':id,'text':text,'type':'weibo'},function(o){if(!o.status){c.trigger('close');window.location.reload();}else if(4==o.status){$('#by-weibo textarea.textarea-13',c).error('请正确邀请文字');}else if(5==o.status){$('#by-weibo textarea.textarea-13',c).error('邀请文字不能超过140字');}else if(6==o.status){$('#by-weibo textarea.textarea-13',c).error('邀请文字中必须包含问题链接');}});break;}}});return false;});var shareWeibo=$('#share-weibo');if(shareWeibo.length>0){$('<p><textarea class="textarea-13" rows="5"></textarea></p>').modal({'title':'转发到微博','action':'转发','scroll':true,'onShow':function(){$('textarea',this).val(shareWeibo.val());},'onAction':function(c){var ta=$('textarea',this);$.post('http://segmentfault.com/api/user',{'do':'weibo','text':ta.val()},function(o){if(!o.status){c.trigger('close');}else if(4==o.status){ta.error('分享内容不能为空白');}else if(5==o.status){ta.error('分享内容不能超过140字');}else if(6==o.status){window.oauthComplete=function(){c.trigger('action');}
var message=$('<p>微博账号登录信息已经过期, 请<strong><a href="#">刷新登录信息</a></strong><p>').insertAfter(ta.parent().hide());$('a',message).click(function(){window.open('http://segmentfault.com/user/oauth/weibo');message.remove();ta.parent().show();return false;});}})},});}
(function(){var id=$('#question article.q-post').attr('id');function flash(e){var e=$(e),a=255,b=239,c=0,d=1,to;setTimeout(function(){$(window).scrollTop(e.offset().top-50);},10);if(e.hasClass('comment')){a=239;b=191;c=1;d=4;}
to=setInterval(function(){a+=c;b+=d;e.css('backgroundColor','#ff'+a.toString(16)+b.toString(16));if(b>=255){clearInterval(to);to=null;}},60);return e.css('backgroundColor','#ff'+a.toString(16)+b.toString(16));}
if(window.location.hash){id=window.location.hash.substring(1);}
var type=id.substring(0,1);switch(type){case'q':break;case'a':var el=$('#'+id);if(el.hasClass('ignored')){$('article.a-ignore a').trigger('click');window.location.hash='#'+id;}
flash(el);break;case'c':var parts=id.split('-'),el=$('#q-'+parts[1]+',#a-'+parts[1]);if(el.hasClass('ignored')){$('article.a-ignore a').trigger('click');}
window.location.hash='#'+el.attr('id');flash(el);setTimeout(function(){$('.comment-list a.more-comments',el).trigger('click');});var toc=setInterval(function(){var c=$('#'+id);if(c.length>0){window.location.hash='#'+id;flash(c);clearInterval(toc);toc=null;}},100);break;default:break;}})();});</script></body>
</html>
